# V3.0 vs V3.1 Comparison

This document outlines the key architectural and functional changes between version `V3.0` and `V3.1` of the Multi-Camera Object Counting system. The primary goal of this refactoring was to improve configuration management, reduce redundancy, and enhance usability.

## 1. Unified Configuration File

### V3.0
- Relied on two separate configuration files: `config_cpu.yaml` and `config_gpu.yaml`.
- This led to significant duplication of settings, making maintenance difficult.
- The user had to manually specify which configuration file to use via the `--config` command-line argument.

### V3.1
- Introduces a single, unified `config.yaml` file.
- Common settings are defined once, and device-specific configurations are organized into `profiles` for `cpu` and `gpu`.
- This eliminates redundancy and centralizes all system settings in one place, improving maintainability.

**Example of `profiles` in `V3.1/config.yaml`:**
```yaml
profiles:
  cpu:
    device: "cpu"
    batch_size: 2
    batch_timeout: 0.25
    consumer:
      mode: "cpu"
      enable_parallel: true
      max_workers: 4

  gpu:
    device: "cuda"
    batch_size: 8
    batch_timeout: 0.5
    consumer:
      mode: "gpu"
      enable_parallel: false
      max_workers: 1
```

## 2. Command-Line Interface (CLI)

### V3.0
- The application was launched using the `--config` argument to specify the entire configuration file.
- Example: `python main.py --config config_gpu.yaml`

### V3.1
- The `--config` argument has been replaced with a more intuitive `--profile` argument.
- The user now specifies a profile (`cpu` or `gpu`) which corresponds to the profiles in `config.yaml`.
- The application intelligently merges the selected profile with the base configuration.
- Includes an `auto` mode (default) that automatically selects the `gpu` profile if a CUDA-enabled device is available, otherwise, it falls back to `cpu`.
- Example: `python main.py --profile gpu`

## 3. Code Architecture & Design

### V3.0
- The `FrameProducer`, `CountingConsumer`, and `GPUOptimizedConsumer` classes were responsible for opening and reading their own configuration files.
- This coupled the core components with the file system and configuration loading logic.

### V3.1
- Configuration loading and parsing are now centralized entirely within `main.py`.
- `main.py` loads the base configuration, merges the selected profile, and passes the final, complete configuration dictionary to the producer and consumer classes.
- The constructors for `FrameProducer`, `CountingConsumer`, and `GPUOptimizedConsumer` have been refactored to accept this configuration dictionary directly, rather than a file path.
- This change results in better **Separation of Concerns**, making the components more modular, easier to test, and independent of the configuration file's structure.

## Summary of Benefits in V3.1

- **Improved Maintainability**: A single configuration file is easier to manage and update.
- **Reduced Redundancy**: Common settings are no longer duplicated.
- **Enhanced Usability**: The `--profile` argument is more user-friendly, and the `auto` mode simplifies execution.
- **Better Software Design**: Centralizing configuration logic and decoupling components from file I/O leads to a cleaner, more robust, and more testable architecture.
